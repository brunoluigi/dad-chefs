<% content_for :title, "Chat with Sous Chef" %>

<%= turbo_stream_from "chat_#{@chat.id}" %>

<div class="max-w-4xl mx-auto">
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">
        <span class="text-amber-600">ğŸ‘¨â€ğŸ³</span> Sous Chef
      </h1>
      <p class="text-gray-500 text-sm">Your AI-powered kitchen companion</p>
    </div>
    <div class="flex items-center gap-4">
      <%= link_to "â† Back", root_path, class: "text-gray-500 hover:text-gray-700 text-sm" %>
      <%= link_to "New Chat", root_path(new_chat: true), class: "text-amber-600 hover:text-amber-700 font-medium text-sm" %>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
    <!-- Messages container -->
    <div id="messages" class="h-[60vh] overflow-y-auto p-6 space-y-4">
      <% if @chat.messages.empty? %>
        <div class="text-center text-gray-400 py-20">
          <div class="text-4xl mb-4">ğŸ‘¨â€ğŸ³</div>
          <p class="font-medium text-gray-600">Your Sous Chef is ready!</p>
          <p class="mt-1">Ask me about recipes, cooking tips, or meal ideas.</p>
        </div>
      <% else %>
        <% @chat.messages.where.not(id: nil).each do |message| %>
          <%= render "chats/message", message: message %>
        <% end %>
      <% end %>
    </div>

    <!-- Message input -->
    <div class="border-t border-gray-100 p-4 bg-gray-50">
      <%= form_with(model: @message, url: chat_messages_path(@chat), id: "new_message", class: "flex gap-3") do |form| %>
        <%= form.text_field :content, 
            class: "flex-1 rounded-lg border-gray-300 shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-200 focus:ring-opacity-50 px-4 py-3",
            placeholder: "Ask your Sous Chef anything...",
            autofocus: true,
            autocomplete: "off" %>
        <%= form.submit "Send", 
            class: "rounded-lg bg-amber-600 px-6 py-3 font-semibold text-white shadow-sm hover:bg-amber-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-600 transition-colors cursor-pointer" %>
      <% end %>
    </div>
  </div>

  <p class="text-center text-xs text-gray-400 mt-4">
    Sous Chef powered by <%= @chat.model&.name || "AI" %> â€¢ Conversations saved
  </p>
</div>